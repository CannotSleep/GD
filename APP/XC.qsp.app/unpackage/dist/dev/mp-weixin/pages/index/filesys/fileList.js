require("../../../common/manifest.js");
require("../../../common/vendor.js");
global.webpackJsonp([43],{138:function(t,e,i){"use strict";var s=a(i(1)),n=a(i(139));function a(t){return t&&t.__esModule?t:{default:t}}new s.default(n.default).$mount()},139:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(141),n=i.n(s),a=i(142),o=!1;var l=function(t){o||i(140)},r=i(0)(n.a,a.a,l,"data-v-9abbe75c",null);r.options.__file="F:\\施工管理平台\\20181101\\XC.qsp.app\\pages\\index\\filesys\\fileList.vue",r.esModule&&Object.keys(r.esModule).some(function(t){return"default"!==t&&"__"!==t.substr(0,2)})&&console.error("named exports are not supported in *.vue files."),r.options.functional&&console.error("[vue-loader] fileList.vue: functional components are not supported with templates, they should use render functions."),e.default=r.exports},140:function(t,e){},141:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(3)),n=a(i(5));function a(t){return t&&t.__esModule?t:{default:t}}e.default={data:function(){return{fileDatalist:[],filePath:"",typeI:9,page:1,loadingType:0,contentText:{contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"没有更多数据了"},typeIndex:0,typeVal:"0",typeList:[{text:"所有文件",value:0},{text:"安全管理文件",value:1},{text:"质量管理文件",value:2},{text:"工程管理文件",value:3},{text:"其他文件",value:4}]}},onLoad:function(e){var i=e.type;switch(i){case"1":t.setNavigationBarTitle({title:"我的文件"});break;case"2":t.setNavigationBarTitle({title:"与我相关"});break;case"0":t.setNavigationBarTitle({title:"共享文件"})}this.Token=s.default.net.GetSessionToken(),this.typeI=i,this.searchBtn()},onPullDownRefresh:function(){this.page=1,this.getFilelist(this.typeI)},components:{loadMore:n.default},onReachBottom:function(){0===this.loadingType&&(this.page=this.page+1,this.loadingType=1,this.getFilelist(this.typeI))},methods:{searchBtn:function(){this.page=1,this.getFilelist(this.typeI)},changeType:function(t){this.typeIndex=t.detail.value,this.typeVal=this.typeList[this.typeIndex].value,this.page=1,this.getFilelist(this.typeI)},getFilelist:function(e){var i=this,n=s.default.net.setUrl("api/FileSystemApi/GetList"),a={page:this.page,operate:e,type:this.typeVal,userName:"",fileName:""};t.request({url:n,method:"GET",data:a,header:{Token:this.Token},success:function(e){t.stopPullDownRefresh(),s.default.net.showWrongTipsEx(e);var n=e.data.data;if(""==n)return t.showToast({title:"暂无数据",mask:!1,icon:"none",duration:1500}),void(i.loadingType=2);var a=!0,o=!1,l=void 0;try{for(var r,c=n[Symbol.iterator]();!(a=(r=c.next()).done);a=!0){var u=r.value;switch(u.AddTime=u.AddTime.substring(0,10),u.Type){case 1:u.Type="安全管理文件";break;case 2:u.Type="质量管理文件";break;case 3:u.Type="工程管理文件";break;case 4:u.Type="其他文件"}var p=!0,d=!1,f=void 0;try{for(var g,h=u.Detail[Symbol.iterator]();!(p=(g=h.next()).done);p=!0){var y=g.value,v=t.getStorageSync(y.ID);y.isDown=v?1:0}}catch(t){d=!0,f=t}finally{try{!p&&h.return&&h.return()}finally{if(d)throw f}}}}catch(t){o=!0,l=t}finally{try{!a&&c.return&&c.return()}finally{if(o)throw l}}n.length<1?i.loadingType=2:(1==i.page&&(i.fileDatalist=[]),i.fileDatalist=i.fileDatalist.concat(n),i.loadingType=0)},fail:function(t){s.default.net.showFailTips(t)},complete:function(t){}})},fileDown:function(e,i,n,a,o,l){var r=this;console.log(l);var c=s.default.net.setUrl("api/FileSystemApi/DownloadFile");t.showLoading({title:"下载中",mask:!0}),t.downloadFile({url:c+"?id="+i+"&filePath="+n,header:{Token:this.Token},success:function(e){console.log(JSON.stringify(e)),console.log(JSON.stringify(e.statusCode)),200!=e.statusCode&&t.showToast({title:"下载失败",mask:!1,icon:"none",duration:1500}),200==e.statusCode&&(r.fileDatalist[a].Detail[o].isDown=1,t.hideLoading(),t.saveFile({tempFilePath:e.tempFilePath,success:function(e){console.log(JSON.stringify(e));var s=JSON.stringify(e.savedFilePath),n=l,a=s.split("/"),o=a[a.length-1];o=o.slice(0,o.length-1),console.log(o),console.log(n),t.setStorageSync(n,o),t.setStorageSync(o,n),t.setStorageSync(i,i)}}))},fail:function(e){t.hideLoading(),console.log("失败"+e),console.log(JSON.stringify(e))},complete:function(e){console.log(e),t.hideLoading()}}).onProgressUpdate(function(t){console.log("下载进度"+t.progress),console.log("已经下载的数据长度"+t.totalBytesWritten),console.log("预期需要下载的数据总长度"+t.totalBytesExpectedToWrite)})},fileOpen:function(e){var i=t.getStorageSync(e);t.openDocument({filePath:"_doc/uniapp_save/"+i,success:function(t){console.log(JSON.stringify(t)),console.log("打开成功")},fail:function(t){console.log(JSON.stringify(t))}})}}}}).call(e,i(2).default)},142:function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"content"},[i("view",{staticClass:"input-row"},[t._m(0),i("picker",{attrs:{value:t.typeIndex,range:t.typeList,"range-key":"text",eventid:"RzU-0"},on:{change:t.changeType}},[i("view",{staticClass:"uni-input"},[t._v(t._s(t.typeList[t.typeIndex].text))])])],1),i("view",{staticClass:"list-content"},[i("view",{staticClass:"uni-list"},[t._l(t.fileDatalist,function(e,s){return i("block",{key:s},t._l(e.Detail,function(n,a){return i("block",{key:a},[i("view",{staticClass:"uni-list-cell",attrs:{"hover-class":"uni-list-cell-hover"}},[i("view",{staticClass:"uni-triplex-row"},[i("view",{staticClass:"uni-triplex-left"},[i("label",{staticClass:"filetext"},[i("text",{staticClass:"list-title uni-ellipsis"},[t._v(t._s(n.FileName))]),i("text",{staticClass:"list-deadline"},[t._v(t._s(e.AddUserName))]),i("text",{staticClass:"list-level"},[t._v(t._s(e.AddTime))]),i("text",{staticClass:"list-state"},[t._v(t._s(e.Type))]),0==n.isDown?i("button",{staticClass:"list-button",attrs:{type:"primary",size:t.mini,loading:!1,eventid:"PEN-1-"+s+"-"+a},on:{tap:function(e){t.fileDown(e,n.ID,n.FileSrc,s,a,n.FileName)}}},[t._v("下载")]):t._e(),1==n.isDown?i("button",{staticClass:"list-button",attrs:{type:"primary",size:t.mini,loading:!1,plain:!0,eventid:"Sqn-2-"+s+"-"+a},on:{tap:function(e){t.fileOpen(n.FileName)}}},[t._v("打开")]):t._e()],1)],1)])])])}))}),i("load-more",{attrs:{loadingType:t.loadingType,contentText:t.contentText,mpcomid:"5LV-0"}})],2)])])};s._withStripped=!0;var n={render:s,staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("view",{staticClass:"input-label"},[e("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-03.png",mode:""}}),e("text",[this._v("文件分类:")])])}]};e.a=n}},[138]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/index/filesys/fileList.js.map