require("../../../common/manifest.js");
require("../../../common/vendor.js");
global.webpackJsonp([42],{134:function(e,t,i){"use strict";var l=o(i(1)),s=o(i(135));function o(e){return e&&e.__esModule?e:{default:e}}new l.default(s.default).$mount()},135:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=i(137),s=i.n(l),o=i(138);var n=function(e){i(136)},a=i(0)(s.a,o.a,n,"data-v-9abbe75c",null);t.default=a.exports},136:function(e,t){},137:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var l,s=i(3),o=(l=s)&&l.__esModule?l:{default:l};t.default={data:function(){return{fileDatalist:[{ID:"00000000-0000-0000-0000-0000000000",ForeignID:"00000000-0000-0000-0000-0000000000",AddUserID:"00000000-0000-0000-0000-0000000000",AddUserName:"管理员2",Remark:"说明2",AddTime:"2018-10-10",Type:3,IsDelete:!1,Detail:[{ID:"00000000-0000-0000-0000-0000000000",MasterID:"00000000-0000-0000-0000-0000000000",FileName:"文件名2-1",FileSrc:"文件相对路径2-1",DownloadCount:1,FileSize:10086,FileType:".pdf",isDown:-1},{ID:"00000000-0000-0000-0000-0000000000",MasterID:"00000000-0000-0000-0000-0000000000",FileName:"文件名2-2",FileSrc:"文件相对路径2-2",DownloadCount:1,FileSize:10086,FileType:".pdf",isDown:-1}]}],filePath:"",typeI:9}},methods:{getFilelist:function(t){var i=this,l=o.default.net.setUrl("api/FileSystemApi/GetList");this.typeI=t;var s={page:1,operate:t,type:0,userName:"",fileName:""};e.request({url:l,method:"GET",data:s,header:{token:this.Token},success:function(t){console.log(t);var l=t.data.data,s=!0,o=!1,n=void 0;try{for(var a,c=l[Symbol.iterator]();!(s=(a=c.next()).done);s=!0){var r=a.value;switch(r.AddTime=r.AddTime.substring(0,10),r.Type){case 1:r.Type="安全管理文件";break;case 2:r.Type="质量管理文件";break;case 3:r.Type="工程管理文件";break;case 4:r.Type="其他文件"}var u=!0,f=!1,d=void 0;try{for(var p,g=r.Detail[Symbol.iterator]();!(u=(p=g.next()).done);u=!0){var v=p.value,y=v.FileSrc.split("/"),h=y[y.length-1];e.getStorageSync(h)?(console.log("对比成功"),v.isDown=1):(console.log("对比失败"),v.isDown=0)}}catch(e){f=!0,d=e}finally{try{!u&&g.return&&g.return()}finally{if(f)throw d}}}}catch(e){o=!0,n=e}finally{try{!s&&c.return&&c.return()}finally{if(o)throw n}}console.log(l),i.fileDatalist=l,e.stopPullDownRefresh()},fail:function(e){},complete:function(e){}})},fileDown:function(t,i,l,s,n){var a=this;console.log("执行文件下载方法");var c=o.default.net.setUrl("api/FileSystemApi/DownloadFile");e.showLoading({title:"下载中",mask:!0}),e.downloadFile({url:c+"?id="+i+"&filePath="+l,header:{Token:this.Token},success:function(t){200===t.statusCode&&(console.log("下载成功"),console.log(t),e.hideLoading(),a.fileDatalist[s].Detail[n].isDown=1),console.log(JSON.stringify(t));var i=t.tempFilePath;e.saveFile({tempFilePath:i,success:function(i){console.log("保存成功"),console.log(i.savedFilePath);var l=i.savedFilePath+"",s=(t.tempFilePath+"").split("&")[0].split("/"),o=s[s.length-1],n=l.split("&")[0].split("/"),a=n[n.length-1];e.setStorage({key:o,data:a,success:function(){console.log("保存success")}}),e.setStorage({key:a,data:o,success:function(){console.log("appsuccess")}})},fail:function(e){console.log("保存失败"),console.log(JSON.stringify(e))}})},fail:function(e){console.log("失败"+e),console.log(JSON.stringify(e))},complete:function(e){console.log(e)}}).onProgressUpdate(function(e){console.log("下载进度"+e.progress),console.log("已经下载的数据长度"+e.totalBytesWritten),console.log("预期需要下载的数据总长度"+e.totalBytesExpectedToWrite)})},fileOpen:function(t){var i="";e.getStorage({key:t,success:function(e){console.log("对比成功"),i=e.data}}),e.openDocument({filePath:"_doc/uniapp_temp/download/uniapp_save/"+i,success:function(e){console.log(JSON.stringify(e)),console.log("打开成功")},fail:function(e){console.log(JSON.stringify(e))}})}},onLoad:function(t){var i=t.type;switch(i){case"1":e.setNavigationBarTitle({title:"我的文件"});break;case"2":e.setNavigationBarTitle({title:"与我相关"});break;case"0":e.setNavigationBarTitle({title:"共享文件"})}this.Token=o.default.net.GetSessionToken(),console.log("测试token："+o.default.net.GetSessionToken()),this.getFilelist(i)},onPullDownRefresh:function(){console.log("下拉刷新"),this.getFilelist(this.typeI)}}}).call(t,i(2).default)},138:function(e,t,i){"use strict";var l={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:"content"},[i("view",{staticClass:"list-content"},[i("view",{staticClass:"uni-list"},e._l(e.fileDatalist,function(t,l){return i("block",{key:l},e._l(t.Detail,function(s,o){return i("block",{key:o},[i("view",{staticClass:"uni-list-cell",attrs:{"hover-class":"uni-list-cell-hover"}},[i("view",{staticClass:"uni-triplex-row"},[i("view",{staticClass:"uni-triplex-left"},[i("label",{staticClass:"filetext"},[i("text",{staticClass:"list-title uni-ellipsis"},[e._v(e._s(s.FileName))]),i("text",{staticClass:"list-deadline"},[e._v(e._s(t.AddUserName))]),i("text",{staticClass:"list-level"},[e._v(e._s(t.AddTime))]),i("text",{staticClass:"list-state"},[e._v(e._s(t.Type))]),0==s.isDown?i("button",{staticClass:"list-button",attrs:{type:"primary",size:e.mini,loading:!1,eventid:"Pr4-0-"+l+"-"+o},on:{tap:function(t){e.fileDown(t,s.ID,s.FileSrc,l,o)}}},[e._v("下载")]):e._e(),1==s.isDown?i("button",{staticClass:"list-button",attrs:{type:"primary",size:e.mini,loading:!1,plain:!0,eventid:"gL3-1-"+l+"-"+o},on:{tap:function(t){e.fileOpen(s.FileName)}}},[e._v("打开")]):e._e()],1)],1)])])])}))}))])])},staticRenderFns:[]};t.a=l}},[134]);