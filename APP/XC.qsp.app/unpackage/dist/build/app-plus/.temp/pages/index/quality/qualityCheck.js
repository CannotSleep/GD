require("../../../common/manifest.js");
require("../../../common/vendor.js");
global.webpackJsonp([31],{44:function(t,e,i){"use strict";var a=s(i(1)),n=s(i(45));function s(t){return t&&t.__esModule?t:{default:t}}new a.default(n.default).$mount()},45:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(47),n=i.n(a),s=i(48);var o=function(t){i(46)},l=i(0)(n.a,s.a,o,"data-v-3316971a",null);e.default=l.exports},46:function(t,e){},47:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var a=s(i(4)),n=s(i(3));function s(t){return t&&t.__esModule?t:{default:t}}e.default={data:function(){return{Token:"",title:"",companyList:["请选择分公司"],companyIndex:0,companyText:"1",companyVal:"1",dong:"",ceng:"",projectList:["请选择项目"],projectIndex:1,projectText:"",projectVal:"",areaList:["请选择区域"],areaVal:"",areaIndex:0,areaText:"",unitList:["请选择施工单位"],unitVal:"",unitIndex:0,unitText:"",rectification:"",dangerList:["请选择隐患类型"],dangerVal:"",dangerIndex:0,dangerText:"请选择隐患描述",dangerDesList:["请选择隐患描述"],dangerDesVal:"",dangerDesIndex:0,dangerDesText:"",rectiList:["请选择整改人"],rectpeople:"整改人",rectpeopleid:"",noticeList:["请选择通知人"],noticepeople:"通知人",noticepeopleid:"",degreeList:[{text:"一般",value:"0"},{text:"紧急",value:"1"},{text:"严重",value:"2"}],degreeVal:0,degreeText:"一般",degreeIndex:0,isDanger:0,checkDate:"2018-09-18",recheckDate:"2018-10-18",deadline:"2018-09-21",time:"12:01",sourceTypeIndex:2,sourceType:["拍照","相册","拍照或相册"],sizeTypeIndex:2,sizeType:["压缩","原图","压缩或原图"],countIndex:8,count:[1,2,3,4,5,6,7,8,9],isfirstopen:1,items:[{name:"是",value:"1"},{name:"否",value:"0"}],imageList:[],qualityId:"",imgupindex:0}},onLoad:function(t){this.Token=n.default.net.GetSessionToken(),this.getCompany(),this.getArea(),this.getUnit(),this.getDanger()},onShow:function(){if(console.log("页面显示"),1!=this.isfirstopen){var e=t.getStorageSync("selectID"),i=t.getStorageSync("selectName");this.rectpeople=i,this.rectpeopleid=e;var a=t.getStorageSync("selectIDs"),n=t.getStorageSync("selectNames");this.noticepeople=n,this.noticepeopleid=a}},onHide:function(){},onUnload:function(){},methods:{submit:function(e){var i=this;t.removeStorageSync("selectID"),t.removeStorageSync("selectName"),t.removeStorageSync("selectIDs"),t.removeStorageSync("selectNames");var a=n.default.net.setUrl("api/QualityApi/Add"),s={Title:this.title,RectPeople:this.rectpeopleid,ResponsibilityArea:this.areaVal,ProjectID:this.projectVal,AdditionalUnit:this.unitVal,BranchCompany:this.companyVal,Building:this.dong,Floor:this.ceng,QualityDangerID:this.dangerVal,QualityDanger:this.dangerText,DangerDesID:this.dangerDesVal,DangerDes:this.dangerDesText,Rectification:this.rectification,NoticePeopleID:this.noticepeopleid,ExpireDate:this.deadline,CrashLevel:this.degreeVal,CheckPeople:n.default.net.GetUser().ID,IsDanger:this.isDanger,Checkdate:this.checkDate};this.formcheck(s)&&t.request({url:a,method:"POST",header:{Token:this.Token},data:JSON.stringify(s),success:function(e){var a=e.data,n=a.data;1==a.status?(t.showToast({title:"提交成功",mask:!1,duration:1500}),i.qualityId=n,console.log(i.qualityId),0!=i.imageList.length?i.uploadImage():(t.hideLoading(),setTimeout(function(){t.navigateBack({delta:1})},2e3))):console.log(a.message)},fail:function(){console.log("提交失败")},complete:function(){}})},sourceTypeChange:function(t){this.sourceTypeIndex=t.target.value},sizeTypeChange:function(t){this.sizeTypeIndex=t.target.value},countChange:function(t){this.countIndex=t.target.value},chooseImage:function(){var e,i=(e=a.default.mark(function e(){var i,n=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(9!==this.imageList.length){e.next=7;break}return e.next=3,this.isFullImg();case 3:if(i=e.sent,console.log("是否继续?",i),i){e.next=7;break}return e.abrupt("return");case 7:t.chooseImage({sourceType:this.sourceType[this.sourceTypeIndex],count:this.imageList.length+this.count[this.countIndex]>9?9-this.imageList.length:this.count[this.countIndex],success:function(t){n.imageList=n.imageList.concat(t.tempFilePaths),console.log(n.imageList)}});case 8:case"end":return e.stop()}},e,this)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function a(n,s){try{var o=t[n](s),l=o.value}catch(t){return void i(t)}if(!o.done)return Promise.resolve(l).then(function(t){a("next",t)},function(t){a("throw",t)});e(l)}("next")})});return function(){return i.apply(this,arguments)}}(),isFullImg:function(){var e=this;return new Promise(function(i){t.showModal({content:"已经有9张图片了,是否清空现有图片？",success:function(t){t.confirm?(e.imageList=[],i(!0)):i(!1)},fail:function(){i(!1)}})})},previewImage:function(e){var i=e.target.dataset.src;t.previewImage({current:i,urls:this.imageList})},removeImage:function(t){console.log("移除图片"),this.imageList.pop()},uploadImage:function(e){var i=this;if(console.log("上传图片"),this.imgupindex!=this.imageList.length){var a=n.default.net.setUrl("api/FileApi/FileUpload");t.uploadFile({url:a,header:{Token:this.Token},filePath:this.imageList[this.imgupindex],name:"123",formData:{foreignId:this.qualityId,type:"2"},success:function(e){console.log(e.data),console.log("上传成功"),i.imgupindex+=1,i.uploadImage(),t.showToast({title:"图片上传成功",mask:!1,duration:1500})}}).onProgressUpdate(function(t){console.log("上传进度"+t.progress),console.log("已经上传的数据长度"+t.totalBytesSent),console.log("预期需要上传的数据总长度"+t.totalBytesExpectedToSend)})}else t.hideLoading(),setTimeout(function(){t.navigateBack({delta:1})},2e3)},tempS:function(e){console.log("暂存");var i={Title:this.title,CompanyID:this.companyVal,CompanyName:this.companyText,CompanyIndex:this.companyIndex,ProjectIndex:this.projectIndex,AreaIndex:this.areaIndex,UnitIndex:this.unitIndex,DangerIndex:this.dangerIndex,DangerDesIndex:this.dangerDesIndex,RectPeople:this.rectpeopleid,RectPeopleName:this.rectpeople,NoticePeople:this.noticepeopleid,NoticePeopleName:this.noticepeople,ProjectId:this.projectVal,ProjectName:this.projectText,SubcontractingUnit:this.unitVal,SubcontractingUnitName:this.unitText,Building:this.dong,Floor:this.ceng,ResponsibilityArea:this.areaVal,ResponsibilityAreaName:this.areaText,SaftyDangerID:this.dangerVal,SaftyDanger:this.dangerText,DangerDesID:this.dangerDesVal,DangerDes:this.dangerDesText,Rectification:this.rectification,ExpirDate:this.deadline,CrashLevel:this.degreeVal,CrashLevelName:this.degreeText,AddPeopleID:n.default.net.GetUser().ID,CheckDate:this.checkDate,ImageList:this.imageList,IsDanger:this.isDanger,DegreeIndex:this.degreeIndex},a=t.getStorageSync("QualityListOffLine");a?(console.log(a),a.push(i)):(a=[]).push(i),t.setStorageSync("QualityListOffLine",a),t.showToast({title:"暂存成功",mask:!1,duration:1500}),setTimeout(function(){t.navigateBack({delta:1})},2e3)},getCompany:function(){var e=this,i=n.default.net.setUrl("api/DropDownListApi/GetCompany");t.request({url:i,dataType:"json",type:"GET",header:{token:this.Token},success:function(i){var a=i.data,n=a.data;if(a.status=1){console.log("公司获取成功");n.unshift({value:"08876894",text:"请选择公司"}),e.companyList=e.setData(n),e.companyVal=e.companyList[e.companyIndex].value,e.companyText=e.companyList[e.companyIndex].text,"08876894"!=e.companyVal&&e.getProject()}else console.log(a.status),t.showToast({title:a.status,mask:!1,duration:1500})},fail:function(t,e){console.log("公司获取失败"+t+e)}})},getProject:function(){var e=this,i=n.default.net.setUrl("api/DropDownListApi/GetProject");t.request({url:i,method:"GET",header:{token:this.Token},data:{company:this.companyVal},success:function(t){var i=t.data,a=i.data;console.log(t),(i.status=1)?(e.projectList=e.setData(a),e.projectVal=e.projectList[e.projectIndex].value,e.projectText=e.projectList[e.projectIndex].text):console.log("项目获取失败"+i.status)},fail:function(t,e){console.log("项目数据请求失败"+t+e)}})},getArea:function(){var e=this,i=n.default.net.setUrl("api/DropDownListApi/GetUtilitySettings");t.request({url:i,method:"POST",header:{token:this.Token},data:JSON.stringify({type:0}),success:function(t){var i=t.data,a=i.data;if(i.status=1){console.log("检查区域获取成功");a.unshift({value:"",text:"请选择检查区域"}),e.areaList=e.setData(a),e.areaVal=e.areaList[e.areaIndex].value,e.areaText=e.areaList[e.areaIndex].text}else console.log("检查区域获取失败"+i.status)},fail:function(t,e){console.log("检查区域数据请求失败"+t+e)}})},getUnit:function(){var e=this,i=n.default.net.setUrl("api/DropDownListApi/GetUtilitySettings");t.request({url:i,method:"POST",header:{token:this.Token},data:JSON.stringify({type:1}),success:function(t){var i=t.data,a=i.data;if(i.status=1){a.unshift({value:"",text:"请选择整改单位"}),e.unitList=e.setData(a),e.unitVal=e.unitList[e.unitIndex].value,e.unitText=e.unitList[e.unitIndex].text}else console.log("施工单位获取失败"+i.status)},fail:function(t,e){console.log("施工单位数据请求失败"+t+e)}})},getDanger:function(){var e=this,i=n.default.net.setUrl("api/DropDownListApi/GetQualityDangerType");t.request({url:i,method:"POST",header:{token:this.Token},data:JSON.stringify({type:1}),success:function(t){var i=t.data,a=i.data;if(i.status=1){a.unshift({value:"088",text:"请选择隐患类型"}),e.dangerList=e.setData(a),e.dangerVal=e.dangerList[e.dangerIndex].value,e.dangerText=e.dangerList[e.dangerIndex].text,"088"!=e.dangerVal&&e.getDangerDes()}else console.log("隐患类型获取失败"+i.status)},fail:function(t,e){console.log("施工单位数据请求失败"+t+e)}})},getDangerDes:function(){var e=this,i=n.default.net.setUrl("api/DropDownListApi/GetQualityDangerDes"),a={size:"9999",page:"1",type:"2",comid:this.dangerVal};t.request({url:i,method:"POST",header:{token:this.Token},data:JSON.stringify(a),success:function(t){var i=t.data,a=i.data;if(console.log(t),i.status=1){a.unshift({value:"088",text:"请选择隐患描述"}),e.dangerDesList=e.setData(i.data),e.dangerDesVal=e.dangerDesList[e.dangerDesIndex].value,e.dangerDesText=e.dangerDesList[e.dangerDesIndex].text}else console.log("隐患描述获取失败"+i.status)},fail:function(t,e){console.log("隐患描述获取失败"+t+e)}})},setData:function(t){var e=[];return null!=t&&0!=t.length&&t.forEach(function(t){e.push({text:t.text,value:t.value})}),e},changeCompany:function(t){this.companyIndex=t.detail.value,this.companyVal=this.companyList[t.detail.value].value,this.companyText=this.companyList[this.companyIndex].text,this.getProject()},changeProject:function(t){this.projectIndex=t.detail.value,this.projectVal=this.projectList[t.detail.value].value,this.projectText=this.projectList[this.projectIndex].text},changeArea:function(t){this.areaIndex=t.detail.value,this.areaText=this.areaList[this.areaIndex].text,this.areaVal=this.areaList[this.areaIndex].value},changeUnit:function(t){this.unitIndex=t.detail.value,this.unitText=this.unitList[this.unitIndex].text,this.unitVal=this.unitList[this.unitIndex].value},changeDanger:function(t){this.dangerIndex=t.detail.value,this.dangerVal=this.dangerList[this.dangerIndex].value,this.dangerText=this.dangerList[this.dangerIndex].text,this.getDangerDes()},changeDangerDes:function(t){this.dangerDesIndex=t.detail.value,this.dangerDesVal=this.dangerDesList[this.dangerDesIndex].value,this.dangerDesText=this.dangerDesList[this.dangerDesIndex].text},selectRect:function(e){this.isfirstopen+=1,t.navigateTo({url:"../../../components/selectPeople"})},selectNotice:function(){this.isfirstopen+=1,t.navigateTo({url:"../../../components/selectPeopleMulti"})},nameInput:function(t){this.title=t.detail.value},dongInput:function(t){this.dong=t.detail.value},cengInput:function(t){this.ceng=t.detail.value},recInput:function(t){this.rectification=t.detail.value},radioChange:function(t){this.isDanger=t.detail.value},formcheck:function(e){return"08876894"==e.BranchCompany?(t.showToast({title:"请选择公司",mask:!1,duration:1500,image:null,icon:"none"}),!1):""==this.projectVal?(t.showToast({title:"请选择项目",mask:!1,duration:1500,image:null,icon:"none"}),!1):""==e.ResponsibilityArea?(t.showToast({title:"请选择检查区域",mask:!0,image:null,icon:"none",duration:1500}),!1):""==e.AdditionalUnit?(t.showToast({title:"请填写整改单位",mask:!1,duration:1500,image:null,icon:"none"}),!1):"088"==e.QualityDangerID?(t.showToast({title:"请选择隐患类型",mask:!1,duration:1500,image:null,icon:"none"}),!1):""==this.dangerDesVal?(t.showToast({title:"请选择隐患描述",mask:!1,duration:1500,image:null,icon:"none"}),!1):""==e.RectPeople?(t.showToast({title:"请选择整改人",mask:!0,image:null,icon:"none",duration:1500}),!1):""==e.NoticePeopleID?(t.showToast({title:"请选择通知人",mask:!1,duration:1500,image:null,icon:"none"}),!1):void 0}}}}).call(e,i(2).default)},48:function(t,e,i){"use strict";var a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"content"},[i("form",{staticClass:"input-form",attrs:{action:"",eventid:"PDk-19"},on:{submit:t.safetySubmit,reset:t.formReset}},[i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-01.png",mode:""}}),i("text",[t._v("所属公司:")])]),i("picker",{attrs:{value:t.companyIndex,range:t.companyList,"range-key":"text",eventid:"WKP-0"},on:{change:t.changeCompany}},[i("view",{staticClass:"uni-input"},[t._v(t._s(t.companyText))])])],1),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-02.png",mode:""}}),i("text",[t._v("项目名称:")])]),i("picker",{attrs:{value:t.projectIndex,range:t.projectList,"range-key":"text",eventid:"wIl-1"},on:{change:t.changeProject}},[i("view",{staticClass:"uni-input"},[t._v(t._s(t.projectText))])])],1),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-03.png",mode:""}}),i("text",[t._v("任务名称:")])]),i("input",{attrs:{type:"text",value:"",placeholder:"请填写任务名称",eventid:"X3f-2"},on:{input:t.nameInput}})]),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-04.png",mode:""}}),i("text",[t._v("检查楼栋:")])]),i("input",{attrs:{type:"text",value:"",placeholder:"请填写检查楼栋号",eventid:"nga-3"},on:{input:t.dongInput}})]),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-05.png",mode:""}}),i("text",[t._v("检查楼层:")])]),i("input",{attrs:{type:"text",value:"",placeholder:"请填写检查楼层号",eventid:"eIf-4"},on:{input:t.cengInput}})]),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-06.png",mode:""}}),i("text",[t._v("检查区域:")])]),i("picker",{attrs:{value:t.areaIndex,range:t.areaList,"range-key":"text",eventid:"61u-5"},on:{change:t.changeArea}},[i("view",{staticClass:"uni-input"},[t._v(t._s(t.areaText))])])],1),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-07.png",mode:""}}),i("text",[t._v("施工单位:")])]),i("picker",{attrs:{value:t.unitIndex,range:t.unitList,"range-key":"text",eventid:"CyI-6"},on:{change:t.changeUnit}},[i("view",{staticClass:"uni-input"},[t._v(t._s(t.unitText))])])],1),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-08.png",mode:""}}),i("text",[t._v("隐患类型:")])]),i("picker",{attrs:{value:t.dangerIndex,range:t.dangerList,"range-key":"text",eventid:"Kqf-7"},on:{change:t.changeDanger}},[i("view",{staticClass:"uni-input"},[t._v(t._s(t.dangerText))])])],1),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-09.png",mode:""}}),i("text",[t._v("隐患描述:")])]),i("picker",{attrs:{value:t.dangerDesVal,range:t.dangerDesList,"range-key":"text",eventid:"j9B-8"},on:{change:t.changeDangerDes}},[i("view",{staticClass:"uni-input"},[t._v(t._s(t.dangerDesText))])])],1),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-11.png",mode:""}}),i("text",[t._v("整改人:")])]),i("input",{attrs:{type:"text",value:t.rectpeople,placeholder:"",eventid:"j0H-9"},on:{tap:t.selectRect}})]),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-12.png",mode:""}}),i("text",[t._v("通知人:")])]),i("input",{attrs:{type:"text",value:t.noticepeople,placeholder:"",eventid:"eCP-10"},on:{tap:t.selectNotice}})]),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-13.png",mode:""}}),i("text",[t._v("整改期限:")])]),i("picker",{attrs:{mode:"date",value:t.deadline,start:"2018-09-18",end:"2028-12-31"}},[i("view",{staticClass:"uni-input"},[t._v(t._s(t.deadline))])])],1),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-05.png",mode:""}}),i("text",[t._v("整改要求:")])]),i("input",{attrs:{type:"text",value:"",placeholder:"请填写整改要求",eventid:"Ore-11"},on:{input:t.recInput}})]),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-14.png",mode:""}}),i("text",[t._v("检查日期:")])]),i("picker",{attrs:{mode:"date",value:t.checkDate,start:"2018-09-18",end:"2028-12-31"}},[i("view",{staticClass:"uni-input"},[t._v(t._s(t.checkDate))])])],1),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-15.png",mode:""}}),i("text",[t._v("是否隐患:")])]),i("radio-group",{staticClass:"radio-group",attrs:{eventid:"Jc7-12",mpcomid:"uXJ-0"},on:{change:t.radioChange}},t._l(t.items,function(e,a){return i("label",{key:e,staticClass:"radio"},[i("radio",{attrs:{value:e.value,checked:e.checked}}),t._v(t._s(e.name)+"\n\t\t\t\t")],1)}))],1),i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-15.png",mode:""}}),i("text",[t._v("严重程度:")])]),i("picker",{attrs:{value:t.degreeIndex,range:t.degreeList,"range-key":"text",eventid:"olH-13"},on:{change:t.changeDegree}},[i("view",{staticClass:"uni-input"},[t._v(t._s(t.degreeText))])])],1),i("view",{staticClass:"input-row-my"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-15.png",mode:""}}),i("text",[t._v("请选择图片:")])])]),i("view",[i("view",{staticClass:"uni-list-cell cell-pd"},[i("view",{staticClass:"uni-uploader"},[i("view",{staticClass:"uni-uploader-head"},[i("view",{staticClass:"uni-uploader-title"},[t._v("点击可预览选好的图片")]),i("view",{staticClass:"uni-uploader-info"},[t._v(t._s(t.imageList.length)+"/9")])]),i("view",{staticClass:"uni-uploader-body"},[i("view",{staticClass:"uni-uploader__files"},t._l(t.imageList,function(e,a){return i("block",{key:a},[i("view",{staticClass:"uni-uploader__file"},[i("image",{staticClass:"uni-uploader__img",attrs:{src:e,"data-src":e,eventid:"AUV-14-"+a},on:{tap:t.previewImage}})])])})),i("view",{staticClass:"uni-uploader__input-box_my"},[i("view",{staticClass:"uni-uploader__input_my",attrs:{eventid:"Z4Z-15"},on:{tap:t.removeImage}})]),i("view",{staticClass:"uni-uploader__input-box"},[i("view",{staticClass:"uni-uploader__input",attrs:{eventid:"zpG-16"},on:{tap:t.chooseImage}})])])])])]),i("view",{staticClass:"mysubmit"},[i("button",{staticClass:"search-btn",attrs:{size:"mini",eventid:"lIo-17"},on:{tap:t.submit}},[t._v("提交")]),i("button",{staticClass:"search-btn",attrs:{size:"mini",type:"default",eventid:"sKb-18"},on:{tap:t.tempS}},[t._v("暂存")])],1)])],1)},staticRenderFns:[]};e.a=a}},[44]);