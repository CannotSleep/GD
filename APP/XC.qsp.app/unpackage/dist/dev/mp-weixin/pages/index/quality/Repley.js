require("../../../common/manifest.js");
require("../../../common/vendor.js");
global.webpackJsonp([36],{252:function(e,t,i){"use strict";var s=a(i(1)),n=a(i(253));function a(e){return e&&e.__esModule?e:{default:e}}new s.default(n.default).$mount()},253:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(255),n=i.n(s),a=i(256),o=!1;var u=function(e){o||i(254)},l=i(0)(n.a,a.a,u,"data-v-5a7ef62d",null);l.options.__file="F:\\施工管理平台\\20181101\\XC.qsp.app\\pages\\index\\quality\\Repley.vue",l.esModule&&Object.keys(l.esModule).some(function(e){return"default"!==e&&"__"!==e.substr(0,2)})&&console.error("named exports are not supported in *.vue files."),l.options.functional&&console.error("[vue-loader] Repley.vue: functional components are not supported with templates, they should use render functions."),t.default=l.exports},254:function(e,t){},255:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var s=a(i(4)),n=a(i(3));function a(e){return e&&e.__esModule?e:{default:e}}t.default={data:function(){return{pageId:"",Type:1,Token:"",SubType:1,Title:"",url:"",Content:"",imageList:[],sourceTypeIndex:2,sizeTypeIndex:2,sourceType:["拍照","相册","拍照或相册"],sizeType:["压缩","原图","压缩或原图"],imgupindex:0,content:"",countIndex:8,count:[1,2,3,4,5,6,7,8,9],forid:"",qtype:0,qid:""}},onLoad:function(t){switch(this.Type=t.Type,this.SubType=t.SubType,this.pageId=t.id,this.Token=n.default.net.GetSessionToken(),this.SubType){case"1":this.Title="回复",this.qtype=0;break;case"2":this.Title="复查",this.qtype=1}switch(this.Type){case"1":this.url="api/SecurityInspectApi/Reply";break;case"2":this.url="api/QualityApi/AddReply"}console.log(this.url),e.setNavigationBarTitle({title:this.Title})},methods:{sourceTypeChange:function(e){this.sourceTypeIndex=e.target.value},sizeTypeChange:function(e){this.sizeTypeIndex=e.target.value},countChange:function(e){this.countIndex=e.target.value},chooseImage:function(){var t,i=(t=s.default.mark(function t(){var i,n=this;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(9!==this.imageList.length){t.next=7;break}return t.next=3,this.isFullImg();case 3:if(i=t.sent,console.log("是否继续?",i),i){t.next=7;break}return t.abrupt("return");case 7:e.chooseImage({sourceType:this.sourceType[this.sourceTypeIndex],sizeType:this.sizeType[this.sizeTypeIndex],count:this.imageList.length+this.count[this.countIndex]>9?9-this.imageList.length:this.count[this.countIndex],success:function(e){n.imageList=n.imageList.concat(e.tempFilePaths),console.log(n.imageList)}});case 8:case"end":return t.stop()}},t,this)}),function(){var e=t.apply(this,arguments);return new Promise(function(t,i){return function s(n,a){try{var o=e[n](a),u=o.value}catch(e){return void i(e)}if(!o.done)return Promise.resolve(u).then(function(e){s("next",e)},function(e){s("throw",e)});t(u)}("next")})});return function(){return i.apply(this,arguments)}}(),isFullImg:function(){var t=this;return new Promise(function(i){e.showModal({content:"已经有9张图片了,是否清空现有图片？",success:function(e){e.confirm?(t.imageList=[],i(!0)):i(!1)},fail:function(){i(!1)}})})},previewImage:function(t){var i=t.target.dataset.src;e.previewImage({current:i,urls:this.imageList})},removeImage:function(e){console.log("移除图片"),this.imageList.pop()},uploadImage:function(t){var i=this;if(console.log("上传图片"),this.imgupindex!=this.imageList.length){var s=n.default.net.setUrl("api/FileApi/FileUpload");e.uploadFile({url:s,header:{Token:this.Token},filePath:this.imageList[this.imgupindex],name:"123",formData:{foreignId:this.qid,type:"2"},success:function(t){n.default.net.showWrongTipsEx(t),console.log(t.data),console.log("上传成功"),i.imgupindex+=1,i.uploadImage(),e.showToast({title:"图片上传成功",mask:!1,duration:1500})}}).onProgressUpdate(function(e){console.log("上传进度"+e.progress),console.log("已经上传的数据长度"+e.totalBytesSent),console.log("预期需要上传的数据总长度"+e.totalBytesExpectedToSend)})}else e.hideLoading(),setTimeout(function(){e.navigateBack({delta:1})},2e3)},Sub:function(e){switch(console.log(this.Type),this.Type){case"1":this.ssub();break;case"2":this.qsub()}},qsub:function(t){var i=this;console.log(this.pageId);var s=n.default.net.setUrl(this.url),a={QualityInspectID:this.pageId,Type:this.qtype,ReplyContent:this.content};e.request({url:s,method:"POST",header:{token:this.Token},data:JSON.stringify(a),success:function(e){n.default.net.showWrongTipsEx(e),console.log(e);var t=e.data.data;i.qid=t,i.uploadImage()},fail:function(){},complete:function(){}})},ssub:function(t){var i=this;console.log(this.pageId);var s=n.default.net.setUrl(this.url),a={SecurityID:this.pageId,Type:this.qtype,ReplyContent:this.content};e.request({url:s,method:"POST",header:{token:this.Token},data:JSON.stringify(a),success:function(e){n.default.net.showWrongTipsEx(e);var t=e.data.data;i.qid=t,console.log(t),i.uploadImage()},fail:function(){},complete:function(){}})}}}}).call(t,i(2).default)},256:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("view",{staticClass:"content"},[i("form",{staticClass:"input-form",attrs:{action:""}},[i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-03.png",mode:""}}),i("text",[e._v(e._s(e.Title)+":")])]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.content,expression:"content"}],attrs:{type:"text",placeholder:"请选择",eventid:"pFJ-0"},domProps:{value:e.content},on:{input:function(t){t.target.composing||(e.content=t.target.value)}}})]),i("view",{staticClass:"input-row-my"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-15.png",mode:""}}),i("text",[e._v("请选择图片:")])])]),i("view",[i("view",{staticClass:"uni-list-cell cell-pd"},[i("view",{staticClass:"uni-uploader"},[i("view",{staticClass:"uni-uploader-head"},[i("view",{staticClass:"uni-uploader-title"},[e._v("点击可预览选好的图片")]),i("view",{staticClass:"uni-uploader-info"},[e._v(e._s(e.imageList.length)+"/9")])]),i("view",{staticClass:"uni-uploader-body"},[i("view",{staticClass:"uni-uploader__files"},e._l(e.imageList,function(t,s){return i("block",{key:s},[i("view",{staticClass:"uni-uploader__file"},[i("image",{staticClass:"uni-uploader__img",attrs:{src:t,"data-src":t,eventid:"G1x-1-"+s},on:{tap:e.previewImage}})])])})),i("view",{staticClass:"uni-uploader__input-box_my"},[i("view",{staticClass:"uni-uploader__input_my",attrs:{eventid:"Jjz-2"},on:{tap:e.removeImage}})]),i("view",{staticClass:"uni-uploader__input-box"},[i("view",{staticClass:"uni-uploader__input",attrs:{eventid:"kTg-3"},on:{tap:e.chooseImage}})])])])])]),i("view",{staticClass:"button-row"},[i("button",{staticClass:"search-btn",attrs:{size:"mini",eventid:"ANY-4"},on:{tap:function(t){e.Sub()}}},[e._v("提交")])],1)])],1)};s._withStripped=!0;var n={render:s,staticRenderFns:[]};t.a=n}},[252]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/index/quality/Repley.js.map