require("../../../common/manifest.js");
require("../../../common/vendor.js");
global.webpackJsonp([30],{130:function(e,t,s){"use strict";var i=l(s(1)),o=l(s(131));function l(e){return e&&e.__esModule?e:{default:e}}new i.default(o.default).$mount()},131:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(133),o=s.n(i),l=s(134),n=!1;var a=function(e){n||s(132)},c=s(0)(o.a,l.a,a,"data-v-9abbe75c",null);c.options.__file="F:\\施工管理平台\\20181101\\XC.qsp.app\\pages\\index\\filesys\\fileList.vue",c.esModule&&Object.keys(c.esModule).some(function(e){return"default"!==e&&"__"!==e.substr(0,2)})&&console.error("named exports are not supported in *.vue files."),c.options.functional&&console.error("[vue-loader] fileList.vue: functional components are not supported with templates, they should use render functions."),t.default=c.exports},132:function(e,t){},133:function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i,o=s(3),l=(i=o)&&i.__esModule?i:{default:i};t.default={data:function(){return{fileDatalist:[{ID:"00000000-0000-0000-0000-0000000000",ForeignID:"00000000-0000-0000-0000-0000000000",AddUserID:"00000000-0000-0000-0000-0000000000",AddUserName:"管理员2",Remark:"说明2",AddTime:"2018-10-10",Type:3,IsDelete:!1,Detail:[{ID:"00000000-0000-0000-0000-0000000000",MasterID:"00000000-0000-0000-0000-0000000000",FileName:"文件名2-1",FileSrc:"文件相对路径2-1",DownloadCount:1,FileSize:10086,FileType:".pdf",isDown:-1},{ID:"00000000-0000-0000-0000-0000000000",MasterID:"00000000-0000-0000-0000-0000000000",FileName:"文件名2-2",FileSrc:"文件相对路径2-2",DownloadCount:1,FileSize:10086,FileType:".pdf",isDown:-1}]}],filePath:"",typeI:9}},methods:{getFilelist:function(t){var s=this,i=l.default.net.setUrl("api/FileSystemApi/GetList");this.typeI=t;var o={page:1,operate:t,type:0,userName:"",fileName:""};e.request({url:i,method:"GET",data:o,header:{token:this.testToken},success:function(t){console.log(t);var i=t.data.data,o=!0,l=!1,n=void 0;try{for(var a,c=i[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var r=a.value;switch(r.AddTime=r.AddTime.substring(0,10),r.Type){case 1:r.Type="安全管理文件";break;case 2:r.Type="质量管理文件";break;case 3:r.Type="工程管理文件";break;case 4:r.Type="其他文件"}var u=function(t){var s=t.FileSrc.split("/"),i=s[s.length-1];e.getStorage({key:i,success:function(e){console.log("对比成功"),t.isDown=1},fail:function(e){console.log("对比失败"),t.isDown=0}})},f=!0,d=!1,p=void 0;try{for(var v,g=r.Detail[Symbol.iterator]();!(f=(v=g.next()).done);f=!0){u(v.value)}}catch(e){d=!0,p=e}finally{try{!f&&g.return&&g.return()}finally{if(d)throw p}}}}catch(e){l=!0,n=e}finally{try{!o&&c.return&&c.return()}finally{if(l)throw n}}s.fileDatalist=i,e.stopPullDownRefresh()},fail:function(e){},complete:function(e){}})},fileDown:function(t,s,i,o,n){var a=this;console.log("执行文件下载方法");l.default.net.setUrl("api/FileSystemApi/DownloadFile");e.showLoading({title:"下载中",mask:!0}),e.downloadFile({url:"http://111.230.193.251:85/api/FileSystemApi/DownloadFile?id="+s+"&filePath="+i,header:{Token:this.testToken},success:function(t){200===t.statusCode&&(console.log("下载成功"),console.log(t),e.hideLoading(),a.fileDatalist[o].Detail[n].isDown=1),console.log(JSON.stringify(t));var s=t.tempFilePath;e.saveFile({tempFilePath:s,success:function(s){console.log("保存成功"),console.log(s.savedFilePath);var i=s.savedFilePath+"",o=(t.tempFilePath+"").split("&")[0].split("/"),l=o[o.length-1],n=i.split("&")[0].split("/"),a=n[n.length-1];e.setStorage({key:l,data:a,success:function(){console.log("保存success")}}),e.setStorage({key:a,data:l,success:function(){console.log("appsuccess")}})},fail:function(e){console.log("保存失败"),console.log(JSON.stringify(e))}})},fail:function(e){console.log("失败"+e),console.log(JSON.stringify(e))},complete:function(e){console.log(e)}}).onProgressUpdate(function(e){console.log("下载进度"+e.progress),console.log("已经下载的数据长度"+e.totalBytesWritten),console.log("预期需要下载的数据总长度"+e.totalBytesExpectedToWrite)})},fileOpen:function(t){var s="";e.getStorage({key:t,success:function(e){console.log("对比成功"),s=e.data}}),e.openDocument({filePath:"_doc/uniapp_temp/download/uniapp_save/"+s,success:function(e){console.log(JSON.stringify(e)),console.log("打开成功")},fail:function(e){console.log(JSON.stringify(e))}})}},onLoad:function(t){var s=t.type;switch(s){case"1":e.setNavigationBarTitle({title:"我的文件"});break;case"2":e.setNavigationBarTitle({title:"与我相关"});break;case"0":e.setNavigationBarTitle({title:"共享文件"})}this.testToken=l.default.net.getTestToken(),console.log("测试token："+l.default.net.getTestToken()),this.getFilelist(s)},onPullDownRefresh:function(){console.log("下拉刷新"),this.getFilelist(this.typeI)}}}).call(t,s(2).default)},134:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("view",{staticClass:"content"},[s("view",{staticClass:"list-content"},[s("view",{staticClass:"uni-list"},e._l(e.fileDatalist,function(t,i){return s("block",{key:i},e._l(t.Detail,function(o,l){return s("block",{key:l},[s("view",{staticClass:"uni-list-cell",attrs:{"hover-class":"uni-list-cell-hover"}},[s("view",{staticClass:"uni-triplex-row"},[s("view",{staticClass:"uni-triplex-left"},[s("text",{staticClass:"list-title uni-ellipsis"},[e._v(e._s(o.FileName))]),e._v(" "),s("text",{staticClass:"list-deadline"},[e._v(e._s(t.AddUserName))]),e._v(" "),s("text",{staticClass:"list-level"},[e._v(e._s(t.AddTime))]),e._v(" "),s("text",{staticClass:"list-state"},[e._v(e._s(t.Type))]),e._v(" "),s("button",{staticClass:"list-button",class:{classdown:1==o.isDown},attrs:{type:"primary",size:e.mini,loading:!1,eventid:"3VE-0-"+i+"-"+l},on:{tap:function(t){e.fileDown(t,o.ID,o.FileSrc,i,l)}}},[e._v("下载")]),e._v(" "),s("button",{staticClass:"list-button",class:{classdown:0==o.isDown},attrs:{type:"primary",size:e.mini,loading:!1,plain:!0,eventid:"iKD-1-"+i+"-"+l},on:{tap:function(t){e.fileOpen(o.FileName)}}},[e._v("打开")])],1)])])])}))}))])])};i._withStripped=!0;var o={render:i,staticRenderFns:[]};t.a=o}},[130]);
//# sourceMappingURL=../../../.sourcemap/pages/index/filesys/fileList.js.map