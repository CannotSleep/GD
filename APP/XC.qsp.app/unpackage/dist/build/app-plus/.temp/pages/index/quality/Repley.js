require("../../../common/manifest.js");
require("../../../common/vendor.js");
global.webpackJsonp([35],{244:function(t,e,i){"use strict";var s=a(i(1)),n=a(i(245));function a(t){return t&&t.__esModule?t:{default:t}}new s.default(n.default).$mount()},245:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(247),n=i.n(s),a=i(248);var o=function(t){i(246)},u=i(0)(n.a,a.a,o,"data-v-5a7ef62d",null);e.default=u.exports},246:function(t,e){},247:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var s=a(i(4)),n=a(i(3));function a(t){return t&&t.__esModule?t:{default:t}}e.default={data:function(){return{pageId:"",Type:1,Token:"",SubType:1,Title:"",url:"",Content:"",imageList:[],sourceTypeIndex:2,sizeTypeIndex:2,sourceType:["拍照","相册","拍照或相册"],sizeType:["压缩","原图","压缩或原图"],imgupindex:0,content:"",countIndex:8,count:[1,2,3,4,5,6,7,8,9],forid:"",qtype:0,qid:""}},onLoad:function(e){switch(this.Type=e.Type,this.SubType=e.SubType,this.pageId=e.id,this.Token=n.default.net.GetSessionToken(),this.SubType){case"1":this.Title="回复",this.qtype=0;break;case"2":this.Title="复查",this.qtype=1}switch(this.Type){case"1":this.url="api/SecurityInspectApi/Reply";break;case"2":this.url="api/QualityApi/AddReply"}console.log(this.url),t.setNavigationBarTitle({title:this.Title})},methods:{sourceTypeChange:function(t){this.sourceTypeIndex=t.target.value},sizeTypeChange:function(t){this.sizeTypeIndex=t.target.value},countChange:function(t){this.countIndex=t.target.value},chooseImage:function(){var e,i=(e=s.default.mark(function e(){var i,n=this;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(9!==this.imageList.length){e.next=7;break}return e.next=3,this.isFullImg();case 3:if(i=e.sent,console.log("是否继续?",i),i){e.next=7;break}return e.abrupt("return");case 7:t.chooseImage({sourceType:this.sourceType[this.sourceTypeIndex],count:this.imageList.length+this.count[this.countIndex]>9?9-this.imageList.length:this.count[this.countIndex],success:function(t){n.imageList=n.imageList.concat(t.tempFilePaths),console.log(n.imageList)}});case 8:case"end":return e.stop()}},e,this)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function s(n,a){try{var o=t[n](a),u=o.value}catch(t){return void i(t)}if(!o.done)return Promise.resolve(u).then(function(t){s("next",t)},function(t){s("throw",t)});e(u)}("next")})});return function(){return i.apply(this,arguments)}}(),isFullImg:function(){var e=this;return new Promise(function(i){t.showModal({content:"已经有9张图片了,是否清空现有图片？",success:function(t){t.confirm?(e.imageList=[],i(!0)):i(!1)},fail:function(){i(!1)}})})},previewImage:function(e){var i=e.target.dataset.src;t.previewImage({current:i,urls:this.imageList})},removeImage:function(t){console.log("移除图片"),this.imageList.pop()},uploadImage:function(e){var i=this;if(console.log("上传图片"),this.imgupindex!=this.imageList.length){var s=n.default.net.setUrl("api/FileApi/FileUpload");t.uploadFile({url:s,header:{Token:this.Token},filePath:this.imageList[this.imgupindex],name:"123",formData:{foreignId:this.qid,type:"2"},success:function(e){console.log(e.data),console.log("上传成功"),i.imgupindex+=1,i.uploadImage(),t.showToast({title:"图片上传成功",mask:!1,duration:1500})}}).onProgressUpdate(function(t){console.log("上传进度"+t.progress),console.log("已经上传的数据长度"+t.totalBytesSent),console.log("预期需要上传的数据总长度"+t.totalBytesExpectedToSend)})}else t.hideLoading(),setTimeout(function(){t.navigateBack({delta:1})},2e3)},Sub:function(t){switch(this.Type){case 1:this.ssub();break;case 2:this.qsub()}},qsub:function(e){var i=this;console.log(this.pageId);var s=n.default.net.setUrl(this.url),a={QualityInspectID:this.pageId,Type:this.qtype,ReplyContent:this.content};t.request({url:s,method:"POST",header:{token:this.Token},data:JSON.stringify(a),success:function(t){console.log(t);var e=t.data.data;i.qid=e,i.uploadImage()},fail:function(){},complete:function(){}})},ssub:function(e){var i=this;console.log(this.pageId);var s=n.default.net.setUrl(this.url),a={SecurityID:this.pageId,Type:this.qtype,ReplyContent:this.content};t.request({url:s,method:"POST",header:{token:this.Token},data:JSON.stringify(a),success:function(t){console.log(t);var e=t.data.data;i.qid=e,i.uploadImage()},fail:function(){},complete:function(){}})}}}}).call(e,i(2).default)},248:function(t,e,i){"use strict";var s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"content"},[i("form",{staticClass:"input-form",attrs:{action:""}},[i("view",{staticClass:"input-row"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-03.png",mode:""}}),i("text",[t._v(t._s(t.Title)+":")])]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],attrs:{type:"text",placeholder:"请选择",eventid:"PxK-0"},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}})]),i("view",{staticClass:"input-row-my"},[i("view",{staticClass:"input-label"},[i("image",{attrs:{src:"../../../static/img/list1_icon/list1_icon-15.png",mode:""}}),i("text",[t._v("请选择图片:")])])]),i("view",[i("view",{staticClass:"uni-list-cell cell-pd"},[i("view",{staticClass:"uni-uploader"},[i("view",{staticClass:"uni-uploader-head"},[i("view",{staticClass:"uni-uploader-title"},[t._v("点击可预览选好的图片")]),i("view",{staticClass:"uni-uploader-info"},[t._v(t._s(t.imageList.length)+"/9")])]),i("view",{staticClass:"uni-uploader-body"},[i("view",{staticClass:"uni-uploader__files"},t._l(t.imageList,function(e,s){return i("block",{key:s},[i("view",{staticClass:"uni-uploader__file"},[i("image",{staticClass:"uni-uploader__img",attrs:{src:e,"data-src":e,eventid:"d9N-1-"+s},on:{tap:t.previewImage}})])])})),i("view",{staticClass:"uni-uploader__input-box_my"},[i("view",{staticClass:"uni-uploader__input_my",attrs:{eventid:"vqb-2"},on:{tap:t.removeImage}})]),i("view",{staticClass:"uni-uploader__input-box"},[i("view",{staticClass:"uni-uploader__input",attrs:{eventid:"0lB-3"},on:{tap:t.chooseImage}})])])])])]),i("view",{staticClass:"button-row"},[i("button",{staticClass:"search-btn",attrs:{size:"mini",eventid:"DJe-4"},on:{tap:function(e){t.Sub()}}},[t._v("提交")])],1)])],1)},staticRenderFns:[]};e.a=s}},[244]);